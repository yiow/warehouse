<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»“åº“ç®¡ç†ç³»ç»Ÿ - å®¢æˆ·ä¸­å¿ƒ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: #f5f7fa;
            color: #333;
        }

        /* å¤´éƒ¨å¯¼èˆª */
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1rem 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 2rem;
        }

        .logo {
            font-size: 1.5em;
            font-weight: bold;
        }

        .nav-right {
            display: flex;
            align-items: center;
            gap: 2rem;
        }

        .cart-icon {
            position: relative;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .cart-icon:hover {
            background: rgba(255,255,255,0.1);
        }

        .cart-count {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #ff4757;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logout-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        /* ä¸»å†…å®¹åŒº */
        .main-container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 2rem;
        }

        .page-title {
            color: #2c3e50;
            margin-bottom: 2rem;
            font-size: 2em;
        }

        /* æœç´¢å’Œç­›é€‰ */
        .search-filter {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 2rem;
            display: flex;
            gap: 1rem;
            align-items: center;
            flex-wrap: wrap;
        }

        .search-box {
            flex: 1;
            min-width: 300px;
            position: relative;
        }

        .search-box input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 1rem;
        }

        .search-box input:focus {
            outline: none;
            border-color: #667eea;
        }

        .category-filter select {
            padding: 0.75rem 1rem;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 1rem;
            background: white;
        }

        /* å•†å“ç½‘æ ¼ */
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .product-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            overflow: hidden;
            transition: all 0.3s ease;
            position: relative;
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .product-image {
            width: 100%;
            height: 200px;
            background: linear-gradient(45deg, #f0f2f5, #e1e5e9);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
            font-size: 3em;
        }

        .product-info {
            padding: 1.5rem;
        }

        .product-name {
            font-size: 1.2em;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 0.5rem;
        }

        .product-description {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 1rem;
            line-height: 1.4;
        }

        .product-price {
            font-size: 1.5em;
            font-weight: bold;
            color: #e74c3c;
            margin-bottom: 1rem;
        }

        .product-stock {
            font-size: 0.9em;
            color: #27ae60;
            margin-bottom: 1rem;
        }

        .stock-low {
            color: #f39c12;
        }

        .stock-out {
            color: #e74c3c;
        }

        .add-to-cart-btn {
            width: 100%;
            padding: 0.75rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .add-to-cart-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .add-to-cart-btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* è´­ç‰©è½¦ä¾§è¾¹æ  */
        .cart-sidebar {
            position: fixed;
            top: 0;
            right: -400px;
            width: 400px;
            height: 100vh;
            background: white;
            box-shadow: -5px 0 15px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            z-index: 1000;
            overflow-y: auto;
        }

        .cart-sidebar.open {
            right: 0;
        }

        .cart-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .cart-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .cart-header {
            padding: 2rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .cart-title {
            font-size: 1.5em;
            margin-bottom: 0.5rem;
        }

        .cart-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            color: white;
            font-size: 1.5em;
            cursor: pointer;
        }

        .cart-content {
            padding: 2rem;
        }

        .cart-item {
            display: flex;
            gap: 1rem;
            padding: 1rem 0;
            border-bottom: 1px solid #eee;
        }

        .cart-item-info {
            flex: 1;
        }

        .cart-item-name {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .cart-item-price {
            color: #e74c3c;
            font-weight: bold;
        }

        .quantity-controls {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .quantity-btn {
            width: 30px;
            height: 30px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .quantity-btn:hover {
            background: #f5f5f5;
        }

        .quantity-input {
            width: 60px;
            text-align: center;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 0.25rem;
        }

        .remove-item {
            color: #e74c3c;
            cursor: pointer;
            font-size: 1.2em;
            padding: 0.5rem;
        }

        .cart-summary {
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 2px solid #eee;
        }

        .total-price {
            font-size: 1.5em;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 1rem;
        }

        .checkout-btn {
            width: 100%;
            padding: 1rem;
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .checkout-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3);
        }

        .checkout-btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* è®¢å•ç¡®è®¤æ¨¡æ€æ¡† */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .modal-title {
            font-size: 1.5em;
            color: #2c3e50;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            color: #999;
        }

        .order-summary {
            margin-bottom: 2rem;
        }

        .order-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0;
            border-bottom: 1px solid #eee;
        }

        .confirm-btn {
            width: 100%;
            padding: 1rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .confirm-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .nav-container {
                padding: 0 1rem;
            }

            .main-container {
                padding: 0 1rem;
            }

            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
                gap: 1rem;
            }

            .cart-sidebar {
                width: 100%;
                right: -100%;
            }

            .search-filter {
                flex-direction: column;
                align-items: stretch;
            }

            .search-box {
                min-width: auto;
            }
        }

        .empty-cart {
            text-align: center;
            padding: 3rem 1rem;
            color: #999;
        }

        .empty-cart svg {
            width: 80px;
            height: 80px;
            margin-bottom: 1rem;
            opacity: 0.3;
        }
    </style>
</head>
<body>
    <!-- å¤´éƒ¨å¯¼èˆª -->
    <header class="header">
        <div class="nav-container">
            <div class="logo">ä»“åº“ç®¡ç†ç³»ç»Ÿ</div>
            <div class="nav-right">
                <div class="cart-icon" onclick="toggleCart()">
                    ğŸ›’
                    <span class="cart-count" id="cartCount">0</span>
                </div>
                <div class="user-info">
                    <span>æ¬¢è¿ï¼Œå®¢æˆ·ç”¨æˆ·</span>
                    <button class="logout-btn" onclick="logout()">é€€å‡ºç™»å½•</button>
                </div>
            </div>
        </div>
    </header>

    <!-- ä¸»å†…å®¹åŒº -->
    <main class="main-container">
        <h1 class="page-title">å•†å“ä¸­å¿ƒ</h1>
        
        <!-- æœç´¢å’Œç­›é€‰ -->
        <div class="search-filter">
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="æœç´¢å•†å“..." onkeyup="searchProducts()">
            </div>
            <div class="category-filter">
                <select id="categoryFilter" onchange="filterByCategory()">
                    <option value="">æ‰€æœ‰åˆ†ç±»</option>
                    <option value="ç”µå­äº§å“">ç”µå­äº§å“</option>
                    <option value="åŠå…¬ç”¨å“">åŠå…¬ç”¨å“</option>
                    <option value="å®¶å±…ç”¨å“">å®¶å±…ç”¨å“</option>
                    <option value="å·¥å…·è®¾å¤‡">å·¥å…·è®¾å¤‡</option>
                </select>
            </div>
        </div>

        <!-- å•†å“ç½‘æ ¼ -->
        <div class="products-grid" id="productsGrid">
            <!-- å•†å“å¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
        </div>
    </main>

    <!-- è´­ç‰©è½¦ä¾§è¾¹æ  -->
    <div class="cart-overlay" id="cartOverlay" onclick="closeCart()"></div>
    <div class="cart-sidebar" id="cartSidebar">
        <div class="cart-header">
            <h2 class="cart-title">è´­ç‰©è½¦</h2>
            <button class="cart-close" onclick="closeCart()">Ã—</button>
        </div>
        <div class="cart-content">
            <div id="cartItems">
                <!-- è´­ç‰©è½¦å•†å“å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
            <div class="cart-summary" id="cartSummary" style="display: none;">
                <div class="total-price" id="totalPrice">æ€»è®¡: Â¥0.00</div>
                <button class="checkout-btn" onclick="showCheckoutModal()">ç«‹å³ç»“ç®—</button>
            </div>
        </div>
    </div>

    <!-- è®¢å•ç¡®è®¤æ¨¡æ€æ¡† -->
    <div class="modal" id="checkoutModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">ç¡®è®¤è®¢å•</h2>
                <button class="modal-close" onclick="closeCheckoutModal()">Ã—</button>
            </div>
            <div class="order-summary" id="orderSummary">
                <!-- è®¢å•è¯¦æƒ…å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
            <button class="confirm-btn" onclick="confirmOrder()">ç¡®è®¤ä¸‹å•</button>
        </div>
    </div>

    <script>
        // å•†å“æ•°æ®
        const products = [
            {
                id: 1,
                name: "ç¬”è®°æœ¬ç”µè„‘",
                description: "é«˜æ€§èƒ½åŠå…¬ç¬”è®°æœ¬ï¼Œé€‚åˆæ—¥å¸¸åŠå…¬å’Œå­¦ä¹ ä½¿ç”¨",
                price: 4999.00,
                stock: 15,
                category: "ç”µå­äº§å“",
                image: "ğŸ’»"
            },
            {
                id: 2,
                name: "æ— çº¿é¼ æ ‡",
                description: "äººä½“å·¥å­¦è®¾è®¡ï¼Œ2.4GHzæ— çº¿è¿æ¥ï¼Œç»­èˆªæŒä¹…",
                price: 89.90,
                stock: 50,
                category: "ç”µå­äº§å“",
                image: "ğŸ–±ï¸"
            },
            {
                id: 3,
                name: "åŠå…¬æ¤…",
                description: "äººä½“å·¥å­¦è®¾è®¡ï¼Œèˆ’é€‚é€æ°”ï¼Œå¯è°ƒèŠ‚é«˜åº¦",
                price: 599.00,
                stock: 8,
                category: "åŠå…¬ç”¨å“",
                image: "ğŸª‘"
            },
            {
                id: 4,
                name: "å°å¼æœºæ˜¾ç¤ºå™¨",
                description: "27è‹±å¯¸é«˜æ¸…æ˜¾ç¤ºå™¨ï¼Œè‰²å½©è¿˜åŸåº¦é«˜",
                price: 1299.00,
                stock: 20,
                category: "ç”µå­äº§å“",
                image: "ğŸ–¥ï¸"
            },
            {
                id: 5,
                name: "æ–‡ä»¶å¤¹",
                description: "A4è§„æ ¼æ–‡ä»¶å¤¹ï¼Œå¤šè‰²å¯é€‰ï¼ŒåŠå…¬å¿…å¤‡",
                price: 12.50,
                stock: 100,
                category: "åŠå…¬ç”¨å“",
                image: "ğŸ“"
            },
            {
                id: 6,
                name: "å’–å•¡æœº",
                description: "å…¨è‡ªåŠ¨å’–å•¡æœºï¼Œå¤šç§å£å‘³é€‰æ‹©ï¼ŒåŠå…¬å®¤é¦–é€‰",
                price: 2199.00,
                stock: 3,
                category: "å®¶å±…ç”¨å“",
                image: "â˜•"
            },
            {
                id: 7,
                name: "æ‰“å°æœº",
                description: "å¤šåŠŸèƒ½æ¿€å…‰æ‰“å°æœºï¼Œæ‰“å°å¤å°æ‰«æä¸‰åˆä¸€",
                price: 1599.00,
                stock: 12,
                category: "åŠå…¬ç”¨å“",
                image: "ğŸ–¨ï¸"
            },
            {
                id: 8,
                name: "ç”µé’»å·¥å…·åŒ…",
                description: "ä¸“ä¸šç”µé’»å·¥å…·åŒ…ï¼Œé€‚åˆç»´ä¿®å’Œå®‰è£…å·¥ä½œ",
                price: 299.00,
                stock: 0,
                category: "å·¥å…·è®¾å¤‡",
                image: "ğŸ”§"
            }
        ];

        // è´­ç‰©è½¦æ•°æ®
        let cart = [];

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            displayProducts(products);
            updateCartDisplay();
        });

        // æ˜¾ç¤ºå•†å“
        function displayProducts(productList) {
            const grid = document.getElementById('productsGrid');
            grid.innerHTML = '';
            
            productList.forEach(product => {
                const productCard = document.createElement('div');
                productCard.className = 'product-card';
                
                let stockClass = '';
                let stockText = `åº“å­˜: ${product.stock} ä»¶`;
                let buttonDisabled = '';
                let buttonText = 'åŠ å…¥è´­ç‰©è½¦';
                
                if (product.stock === 0) {
                    stockClass = 'stock-out';
                    stockText = 'æš‚æ—¶ç¼ºè´§';
                    buttonDisabled = 'disabled';
                    buttonText = 'æš‚æ—¶ç¼ºè´§';
                } else if (product.stock < 10) {
                    stockClass = 'stock-low';
                    stockText = `ä»…å‰© ${product.stock} ä»¶`;
                }
                
                productCard.innerHTML = `
                    <div class="product-image">${product.image}</div>
                    <div class="product-info">
                        <div class="product-name">${product.name}</div>
                        <div class="product-description">${product.description}</div>
                        <div class="product-price">Â¥${product.price.toFixed(2)}</div>
                        <div class="product-stock ${stockClass}">${stockText}</div>
                        <button class="add-to-cart-btn" onclick="addToCart(${product.id})" ${buttonDisabled}>
                            ${buttonText}
                        </button>
                    </div>
                `;
                
                grid.appendChild(productCard);
            });
        }

        // æœç´¢å•†å“
        function searchProducts() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const category = document.getElementById('categoryFilter').value;
            
            let filteredProducts = products.filter(product => {
                const matchesSearch = product.name.toLowerCase().includes(searchTerm) || 
                                    product.description.toLowerCase().includes(searchTerm);
                const matchesCategory = !category || product.category === category;
                return matchesSearch && matchesCategory;
            });
            
            displayProducts(filteredProducts);
        }

        // æŒ‰åˆ†ç±»ç­›é€‰
        function filterByCategory() {
            searchProducts();
        }

        // æ·»åŠ åˆ°è´­ç‰©è½¦
        function addToCart(productId) {
            const product = products.find(p => p.id === productId);
            if (!product || product.stock === 0) return;
            
            const existingItem = cart.find(item => item.id === productId);
            
            if (existingItem) {
                if (existingItem.quantity < product.stock) {
                    existingItem.quantity++;
                } else {
                    alert('åº“å­˜ä¸è¶³ï¼');
                    return;
                }
            } else {
                cart.push({
                    ...product,
                    quantity: 1
                });
            }
            
            updateCartDisplay();
            
            // æ˜¾ç¤ºæ·»åŠ æˆåŠŸæç¤º
            const button = event.target;
            const originalText = button.textContent;
            button.textContent = 'å·²æ·»åŠ ï¼';
            button.style.background = '#27ae60';
            setTimeout(() => {
                button.textContent = originalText;
                button.style.background = '';
            }, 1000);
        }

        // æ›´æ–°è´­ç‰©è½¦æ˜¾ç¤º
        function updateCartDisplay() {
            const cartCount = document.getElementById('cartCount');
            const cartItems = document.getElementById('cartItems');
            const cartSummary = document.getElementById('cartSummary');
            const totalPrice = document.getElementById('totalPrice');
            
            const totalQuantity = cart.reduce((sum, item) => sum + item.quantity, 0);
            const totalAmount = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            
            cartCount.textContent = totalQuantity;
            
            if (cart.length === 0) {
                cartItems.innerHTML = `
                    <div class="empty-cart">
                        <div style="font-size: 4em; margin-bottom: 1rem;">ğŸ›’</div>
                        <p>è´­ç‰©è½¦æ˜¯ç©ºçš„</p>
                        <p>å¿«å»é€‰è´­å•†å“å§ï¼</p>
                    </div>
                `;
                cartSummary.style.display = 'none';
            } else {
                cartItems.innerHTML = cart.map(item => `
                    <div class="cart-item">
                        <div class="cart-item-info">
                            <div class="cart-item-name">${item.name}</div>
                            <div class="cart-item-price">Â¥${item.price.toFixed(2)}</div>
                            <div class="quantity-controls">
                                <button class="quantity-btn" onclick="updateQuantity(${item.id}, -1)">-</button>
                                <input type="number" class="quantity-input" value="${item.quantity}" 
                                       onchange="setQuantity(${item.id}, this.value)" min="1" max="${item.stock}">
                                <button class="quantity-btn" onclick="updateQuantity(${item.id}, 1)">+</button>
                            </div>
                        </div>
                        <div class="remove-item" onclick="removeFromCart(${item.id})">ğŸ—‘ï¸</div>
                    </div>
                `).join('');
                
                totalPrice.textContent = `æ€»è®¡: Â¥${totalAmount.toFixed(2)}`;
                cartSummary.style.display = 'block';
            }
        }

        // æ›´æ–°å•†å“æ•°é‡
        function updateQuantity(productId, change) {
            const item = cart.find(item => item.id === productId);
            const product = products.find(p => p.id === productId);
            
            if (item) {
                const newQuantity = item.quantity + change;
                if (newQuantity > 0 && newQuantity <= product.stock) {
                    item.quantity = newQuantity;
                    updateCartDisplay();
                } else if (newQuantity <= 0) {
                    removeFromCart(productId);
                } else {
                    alert('åº“å­˜ä¸è¶³ï¼');
                }
            }
        }

        // è®¾ç½®å•†å“æ•°é‡
        function setQuantity(productId, quantity) {
            const item = cart.find(item => item.id === productId);
            const product = products.find(p => p.id === productId);
            const qty = parseInt(quantity);
            
            if (item && qty > 0 && qty <= product.stock) {
                item.quantity = qty;
                updateCartDisplay();
            } else if (qty <= 0) {
                removeFromCart(productId);
            } else {
                alert('åº“å­˜ä¸è¶³ï¼');
                updateCartDisplay();
            }
        }

        // ä»è´­ç‰©è½¦ç§»é™¤å•†å“
        function removeFromCart(productId) {
            cart = cart.filter(item => item.id !== productId);
            updateCartDisplay();
        }

        // åˆ‡æ¢è´­ç‰©è½¦æ˜¾ç¤º
        function toggleCart() {
            const sidebar = document.getElementById('cartSidebar');
            const overlay = document.getElementById('cartOverlay');
            
            sidebar.classList.toggle('open');
            overlay.classList.toggle('active');
        }

        // å…³é—­è´­ç‰©è½¦
        function closeCart() {
            const sidebar = document.getElementById('cartSidebar');
            const overlay = document.getElementById('cartOverlay');
            
            sidebar.classList.remove('open');
            overlay.classList.remove('active');
        }

        // æ˜¾ç¤ºç»“ç®—æ¨¡æ€æ¡†
        function showCheckoutModal() {
            if (cart.length === 0) {
                alert('è´­ç‰©è½¦æ˜¯ç©ºçš„ï¼');
                return;
            }
            
            const modal = document.getElementById('checkoutModal');
            const orderSummary = document.getElementById('orderSummary');
            const totalAmount = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            
            orderSummary.innerHTML = `
                <h3 style="margin-bottom: 1rem; color: #2c3e50;">è®¢å•è¯¦æƒ…</h3>
                ${cart.map(item => `
                    <div class="order-item">
                        <div>
                            <div style="font-weight: 600;">${item.name}</div>
                            <div style="color: #666; font-size: 0.9em;">æ•°é‡: ${item.quantity}</div>
                        </div>
                        <div style="font-weight: bold; color: #e74c3c;">
                            Â¥${(item.price * item.quantity).toFixed(2)}
                        </div>
                    </div>
                `).join('')}
                <div class="order-item" style="border-top: 2px solid #eee; margin-top: 1rem; padding-top: 1rem;">
                    <div style="font-size: 1.2em; font-weight: bold;">æ€»è®¡</div>
                    <div style="font-size: 1.5em; font-weight: bold; color: #e74c3c;">
                        Â¥${totalAmount.toFixed(2)}
                    </div>
                </div>
            `;
            
            modal.classList.add('active');
        }

        // å…³é—­ç»“ç®—æ¨¡æ€æ¡†
        function closeCheckoutModal() {
            const modal = document.getElementById('checkoutModal');
            modal.classList.remove('active');
        }

        // ç¡®è®¤è®¢å•
        function confirmOrder() {
            if (cart.length === 0) {
                alert('è´­ç‰©è½¦æ˜¯ç©ºçš„ï¼');
                return;
            }
            
            // ç”Ÿæˆè®¢å•å·
            const orderNumber = 'WMS' + Date.now();
            const orderDate = new Date().toLocaleString('zh-CN');
            const totalAmount = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            
            // ç”Ÿæˆè´­ä¹°æ¸…å•
            const orderDetails = {
                orderNumber: orderNumber,
                orderDate: orderDate,
                customerName: 'å®¢æˆ·ç”¨æˆ·',
                items: [...cart],
                totalAmount: totalAmount,
                status: 'å·²ç¡®è®¤'
            };
            
            // æ¨¡æ‹Ÿæäº¤è®¢å•åˆ°åç«¯
            console.log('è®¢å•è¯¦æƒ…:', orderDetails);
            
            // æ˜¾ç¤ºè®¢å•æˆåŠŸé¡µé¢
            showOrderSuccess(orderDetails);
            
            // æ¸…ç©ºè´­ç‰©è½¦
            cart = [];
            updateCartDisplay();
            closeCheckoutModal();
            closeCart();
        }

        // æ˜¾ç¤ºè®¢å•æˆåŠŸé¡µé¢
        function showOrderSuccess(orderDetails) {
            const modal = document.getElementById('checkoutModal');
            const modalContent = modal.querySelector('.modal-content');
            
            modalContent.innerHTML = `
                <div style="text-align: center; padding: 2rem;">
                    <div style="font-size: 4em; color: #27ae60; margin-bottom: 1rem;">âœ…</div>
                    <h2 style="color: #27ae60; margin-bottom: 1rem;">è®¢å•æäº¤æˆåŠŸï¼</h2>
                    <p style="color: #666; margin-bottom: 2rem;">æ„Ÿè°¢æ‚¨çš„è´­ä¹°ï¼Œæˆ‘ä»¬å°†å°½å¿«ä¸ºæ‚¨å¤„ç†è®¢å•</p>
                    
                    <div style="background: #f8f9fa; padding: 2rem; border-radius: 8px; margin-bottom: 2rem; text-align: left;">
                        <h3 style="color: #2c3e50; margin-bottom: 1rem;">è®¢å•ä¿¡æ¯</h3>
                        <div style="margin-bottom: 0.5rem;"><strong>è®¢å•å·:</strong> ${orderDetails.orderNumber}</div>
                        <div style="margin-bottom: 0.5rem;"><strong>ä¸‹å•æ—¶é—´:</strong> ${orderDetails.orderDate}</div>
                        <div style="margin-bottom: 0.5rem;"><strong>å®¢æˆ·:</strong> ${orderDetails.customerName}</div>
                        <div style="margin-bottom: 1rem;"><strong>è®¢å•çŠ¶æ€:</strong> <span style="color: #27ae60;">${orderDetails.status}</span></div>
                        
                        <h4 style="color: #2c3e50; margin-bottom: 1rem;">å•†å“æ¸…å•</h4>
                        ${orderDetails.items.map(item => `
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.5rem 0; border-bottom: 1px solid #eee;">
                                <div>
                                    <div style="font-weight: 600;">${item.name}</div>
                                    <div style="color: #666; font-size: 0.9em;">å•ä»·: Â¥${item.price.toFixed(2)} Ã— ${item.quantity}</div>
                                </div>
                                <div style="font-weight: bold; color: #e74c3c;">
                                    Â¥${(item.price * item.quantity).toFixed(2)}
                                </div>
                            </div>
                        `).join('')}
                        
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem 0; border-top: 2px solid #eee; margin-top: 1rem;">
                            <div style="font-size: 1.2em; font-weight: bold;">è®¢å•æ€»é¢</div>
                            <div style="font-size: 1.5em; font-weight: bold; color: #e74c3c;">
                                Â¥${orderDetails.totalAmount.toFixed(2)}
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 1rem; justify-content: center;">
                        <button onclick="printOrder('${orderDetails.orderNumber}')" 
                                style="padding: 0.75rem 1.5rem; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">
                            æ‰“å°è®¢å•
                        </button>
                        <button onclick="downloadOrder('${orderDetails.orderNumber}')" 
                                style="padding: 0.75rem 1.5rem; background: #f39c12; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">
                            ä¸‹è½½è®¢å•
                        </button>
                        <button onclick="closeOrderSuccess()" 
                                style="padding: 0.75rem 1.5rem; background: #27ae60; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">
                            ç»§ç»­è´­ç‰©
                        </button>
                    </div>
                </div>
            `;
            
            // ä¿å­˜è®¢å•åˆ°æœ¬åœ°å­˜å‚¨ï¼ˆæ¨¡æ‹Ÿæ•°æ®åº“ï¼‰
            saveOrderToStorage(orderDetails);
        }

        // ä¿å­˜è®¢å•åˆ°æœ¬åœ°å­˜å‚¨
        function saveOrderToStorage(orderDetails) {
            let orders = JSON.parse(localStorage.getItem('customerOrders') || '[]');
            orders.push(orderDetails);
            localStorage.setItem('customerOrders', JSON.stringify(orders));
        }

        // å…³é—­è®¢å•æˆåŠŸé¡µé¢
        function closeOrderSuccess() {
            const modal = document.getElementById('checkoutModal');
            modal.classList.remove('active');
            
            // æ¢å¤æ¨¡æ€æ¡†åŸå§‹å†…å®¹
            const modalContent = modal.querySelector('.modal-content');
            modalContent.innerHTML = `
                <div class="modal-header">
                    <h2 class="modal-title">ç¡®è®¤è®¢å•</h2>
                    <button class="modal-close" onclick="closeCheckoutModal()">Ã—</button>
                </div>
                <div class="order-summary" id="orderSummary">
                    <!-- è®¢å•è¯¦æƒ…å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
                <button class="confirm-btn" onclick="confirmOrder()">ç¡®è®¤ä¸‹å•</button>
            `;
        }

        // æ‰“å°è®¢å•
        function printOrder(orderNumber) {
            const orders = JSON.parse(localStorage.getItem('customerOrders') || '[]');
            const order = orders.find(o => o.orderNumber === orderNumber);
            
            if (!order) {
                alert('è®¢å•æœªæ‰¾åˆ°ï¼');
                return;
            }
            
            // åˆ›å»ºæ‰“å°å†…å®¹
            const printContent = `
                <html>
                <head>
                    <title>è®¢å•æ‰“å° - ${order.orderNumber}</title>
                    <style>
                        body { font-family: 'Microsoft YaHei', Arial, sans-serif; margin: 20px; }
                        .header { text-align: center; margin-bottom: 30px; border-bottom: 2px solid #333; padding-bottom: 20px; }
                        .order-info { margin-bottom: 30px; }
                        .order-info div { margin-bottom: 8px; }
                        table { width: 100%; border-collapse: collapse; margin-bottom: 30px; }
                        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
                        th { background-color: #f5f5f5; font-weight: bold; }
                        .total { font-size: 1.2em; font-weight: bold; text-align: right; }
                        .footer { margin-top: 30px; text-align: center; color: #666; }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>ä»“åº“ç®¡ç†ç³»ç»Ÿ</h1>
                        <h2>è´­ä¹°è®¢å•</h2>
                    </div>
                    
                    <div class="order-info">
                        <div><strong>è®¢å•å·:</strong> ${order.orderNumber}</div>
                        <div><strong>ä¸‹å•æ—¶é—´:</strong> ${order.orderDate}</div>
                        <div><strong>å®¢æˆ·:</strong> ${order.customerName}</div>
                        <div><strong>è®¢å•çŠ¶æ€:</strong> ${order.status}</div>
                    </div>
                    
                    <table>
                        <thead>
                            <tr>
                                <th>å•†å“åç§°</th>
                                <th>å•ä»·</th>
                                <th>æ•°é‡</th>
                                <th>å°è®¡</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${order.items.map(item => `
                                <tr>
                                    <td>${item.name}</td>
                                    <td>Â¥${item.price.toFixed(2)}</td>
                                    <td>${item.quantity}</td>
                                    <td>Â¥${(item.price * item.quantity).toFixed(2)}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                    
                    <div class="total">
                        è®¢å•æ€»é¢: Â¥${order.totalAmount.toFixed(2)}
                    </div>
                    
                    <div class="footer">
                        <p>æ„Ÿè°¢æ‚¨çš„è´­ä¹°ï¼</p>
                        <p>å¦‚æœ‰é—®é¢˜è¯·è”ç³»å®¢æœ</p>
                    </div>
                </body>
                </html>
            `;
            
            // æ‰“å¼€æ‰“å°çª—å£
            const printWindow = window.open('', '_blank');
            printWindow.document.write(printContent);
            printWindow.document.close();
            printWindow.print();
        }

        // ä¸‹è½½è®¢å•
        function downloadOrder(orderNumber) {
            const orders = JSON.parse(localStorage.getItem('customerOrders') || '[]');
            const order = orders.find(o => o.orderNumber === orderNumber);
            
            if (!order) {
                alert('è®¢å•æœªæ‰¾åˆ°ï¼');
                return;
            }
            
            // åˆ›å»ºè®¢å•æ–‡æœ¬å†…å®¹
            const orderText = `
ä»“åº“ç®¡ç†ç³»ç»Ÿ - è´­ä¹°è®¢å•

è®¢å•ä¿¡æ¯:
è®¢å•å·: ${order.orderNumber}
ä¸‹å•æ—¶é—´: ${order.orderDate}
å®¢æˆ·: ${order.customerName}
è®¢å•çŠ¶æ€: ${order.status}

å•†å“æ¸…å•:
${order.items.map(item => 
    `${item.name} - å•ä»·: Â¥${item.price.toFixed(2)} Ã— ${item.quantity} = Â¥${(item.price * item.quantity).toFixed(2)}`
).join('\n')}

è®¢å•æ€»é¢: Â¥${order.totalAmount.toFixed(2)}

æ„Ÿè°¢æ‚¨çš„è´­ä¹°ï¼
å¦‚æœ‰é—®é¢˜è¯·è”ç³»å®¢æœ
            `.trim();
            
            // åˆ›å»ºå¹¶ä¸‹è½½æ–‡ä»¶
            const blob = new Blob([orderText], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `è®¢å•_${order.orderNumber}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // é€€å‡ºç™»å½•
        function logout() {
            if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
                // æ¸…é™¤è´­ç‰©è½¦
                cart = [];
                updateCartDisplay();
                
                // è¿™é‡Œå¯ä»¥æ¸…é™¤ç™»å½•çŠ¶æ€
                // localStorage.removeItem('userToken');
                
                // è·³è½¬åˆ°ç™»å½•é¡µé¢
                alert('å·²é€€å‡ºç™»å½•');
                // window.location.href = '/login.html';
            }
        }

        // é¡µé¢å…³é—­å‰ä¿å­˜è´­ç‰©è½¦
        window.addEventListener('beforeunload', function() {
            localStorage.setItem('customerCart', JSON.stringify(cart));
        });

        // é¡µé¢åŠ è½½æ—¶æ¢å¤è´­ç‰©è½¦
        window.addEventListener('load', function() {
            const savedCart = localStorage.getItem('customerCart');
            if (savedCart) {
                cart = JSON.parse(savedCart);
                updateCartDisplay();
            }
        });
    </script>
</body>
</html>